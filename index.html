<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>NYPD Vehicle Crash Data Charts</title>

    <!-- The Styles -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.1.1/cerulean/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="assets/c3.css">
    <style type="text/css">
      body {
        margin-top: 40px;
      }
    </style>

  </head>

  <body role="document">

    <!-- Fixed navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">NYPD Vehicle Crash Data</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="about.html">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container theme-showcase" role="main">

      <div class="page-header">
        <h1>Accidents by Precinct (Brooklyn)</h1>
        <h4>Number of accidents with contributing factors reported</h4>
      </div>

      <div id="chart"></div>
      

      <div class="page-header">
        <h1>Joing Resource in CivicData.io</h1>
      </div>
      <p><a href="http://www.civicdata.io/en/home">CivicData.io</a>'s SQL Search API lets you execute SQL statements against datasets, and even combine them with SQL joins. This makes it possible to run queries across different data sets and mash up data in new and intersting ways.</p>
      <p>The chart above was generated by querying two different data sets in CivicData.io. To see the raw JSON resonse for the SQL query below, click <a href="http://www.civicdata.com/api/action/datastore_search_sql?sql=SELECT%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22OccurrencePrecinctCode%22%20AS%20%22Precinct%20Code%22,%20COUNT(%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22CollisionID%22)%20AS%20%22Num%20Accidents%20where%20factors%20reported%22%20from%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22,%20%22f5795be2-ac78-4580-b831-3df42842071c%22%20WHERE%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22CollisionID%22%20=%20%22f5795be2-ac78-4580-b831-3df42842071c%22.%22CollisionID%22%20AND%20%22f5795be2-ac78-4580-b831-3df42842071c%22.%22ContributingFactorCode%22%20IS%20NOT%20NULL%20GROUP%20BY%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22OccurrencePrecinctCode%22%20ORDER%20BY%20%22Num%20Accidents%20where%20factors%20reported%22%20DESC">here</a>.</p>
      <div class="well">
        <pre>
    SELECT "ac4a59ea-bf90-4623-9d41-9046875171b2"."OccurrencePrecinctCode" AS "Precinct Code", 
    COUNT("ac4a59ea-bf90-4623-9d41-9046875171b2"."CollisionID") AS "Num Accidents where factors reported"
    from  "ac4a59ea-bf90-4623-9d41-9046875171b2", "f5795be2-ac78-4580-b831-3df42842071c"
    WHERE "ac4a59ea-bf90-4623-9d41-9046875171b2"."CollisionID" = "f5795be2-ac78-4580-b831-3df42842071c"."CollisionID"
    AND "f5795be2-ac78-4580-b831-3df42842071c"."ContributingFactorCode" IS NOT NULL
    GROUP BY "ac4a59ea-bf90-4623-9d41-9046875171b2"."OccurrencePrecinctCode"
    ORDER BY "Num Accidents where factors reported" DESC
        </pre>
      </div>


    </div> <!-- /container -->


    <!-- Le JavaScripts-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="assets/c3.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
         
        var url = 'http://www.civicdata.com/api/action/datastore_search_sql?sql=SELECT%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22OccurrencePrecinctCode%22%20AS%20%22Precinct%22,%20COUNT(%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22CollisionID%22)%20AS%20%22Num%22%20from%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22,%20%22f5795be2-ac78-4580-b831-3df42842071c%22%20WHERE%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22CollisionID%22%20=%20%22f5795be2-ac78-4580-b831-3df42842071c%22.%22CollisionID%22%20AND%20%22f5795be2-ac78-4580-b831-3df42842071c%22.%22ContributingFactorCode%22%20IS%20NOT%20NULL%20GROUP%20BY%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22OccurrencePrecinctCode%22%20ORDER%20BY%20%22Num%22%20DESC'; 
        
        // Helper function to make request for JSONP.
        function requestJSON(url, callback) {
          $.ajax({
            url: url,
            complete: function(xhr) {
              callback.call(null, xhr.responseJSON);
            }
          });
        }

        // Make API call and format results.
        requestJSON(url, function(json) {
          var records = json.result.records
          var counts = [];
          for(var i=0; i<records.length; i++) {
            counts.push(['Preceinct ' + records[i].Precinct, records[i].Num]);
          }

            // Draw the bar chart.
            var chart = c3.generate({
              bindto: '#chart',
              data: {
                  columns: counts,
                  type: 'bar',
                  labels: true
              },
              bar: {
                  width: {
                      ratio: 1.0 
                  }
              },
              legend: {
                  position: 'right'
              },
              tooltip: {
                  show: false
              }
          });

        });

      });
    </script>
  </body>
</html>